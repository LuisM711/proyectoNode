extends layout
block content
    .container.mt-5
      .row
        .col-md-10.mx-auto
          .table-responsive
            table.table.table-striped
              thead
                tr
                  th ID del Empleado
                  th Nombre de Usuario
                  th Rango
                  th Usuario Dado de Alta
                  th Dirección del usuario
                  th Celular del usuario
                  th RFC del usuario
                  th NSS del usuario
                  th CURP del usuario
                  // Agrega más columnas para otros campos si es necesario
              tbody
                each empleado in empleadosData
                  tr(data-bs-toggle="modal" data-bs-target="#userModal" data-idemp="#{empleado.IDEmp}" data-username="#{empleado.Usuario}" data-cargo="#{empleado.Rango}" data-alta="#{empleado.Alta ? 'Si' : 'No'}" data-direccion="#{empleado.Direccion}" data-celular="#{empleado.Celular}" data-rfc="#{empleado.RFC}" data-nss="#{empleado.NSS}" data-curp="#{empleado.CURP}")
                    td= empleado.IDEmp
                    td= empleado.Usuario
                    td= empleado.Rango
                    td= empleado.Alta ? 'Si' : 'No'
                    td= empleado.Direccion
                    td= empleado.Celular
                    td= empleado.RFC
                    td= empleado.NSS
                    td= empleado.CURP
        // Modal para mostrar la información detallada del usuario
        .modal.fade#userModal(tabindex="-1" aria-labelledby="userModalLabel" aria-hidden="true")
          .modal-dialog.modal-dialog-centered.modal-lg
            .modal-content
              .modal-header
                h5.modal-title#userModalLabel Información del Usuario
                button.btn-close(type="button" data-bs-dismiss="modal" aria-label="Close")
              .modal-body
                form(id="userForm", action="/guardarCambios", method="POST")
                  .mb-3.row
                    .col-md-4
                      label(for="idEmpleado", class="form-label") ID del Empleado
                      input(type="text", class="form-control", id="idEmpleado", name="idEmpleado", placeholder="ID del empleado", readonly=true, required)
                    .col-md-4
                      label(for="username", class="form-label") Nombre de Usuario
                      input(type="text", class="form-control", id="username", name="username", placeholder="Nombre de usuario", required)
                    .col-md-4
                      label(for="direccion", class="form-label") Dirección
                      input(type="text", class="form-control", id="direccion", name="direccion", placeholder="Direccion del usuario", required)

                  .mb-3.row
                    .col-md-4
                      label(for="celular", class="form-label") Celular del Usuario
                      input(type="text", class="form-control", id="celular", name="celular", placeholder="Celular de usuario", required)
                    .col-md-4
                      label(for="RFC", class="form-label") RFC del Usuario
                      input(type="text", class="form-control", id="RFC", name="RFC", placeholder="RFC del usuario", required)
                    .col-md-4
                      label(for="NSS", class="form-label") NSS del Usuario
                      input(type="text", class="form-control", id="NSS", name="NSS", placeholder="NSS del usuario", required)

                  .mb-3.row
                    .col-md-4
                      label(for="CURP", class="form-label") CURP del Usuario
                      input(type="text", class="form-control", id="CURP", name="CURP", placeholder="CURP del usuario", required)
                    .col-md-4
                      label(for="role", class="form-label") Rango
                      select.form-select#role(name="role", required)
                        each cargo in cargosData
                          option(value=cargo.IDCargos)= cargo.Cargos
                    .col-md-4
                      .form-check
                        input(type="checkbox", class="form-check-input", id="active", name="isActive")
                        label.form-check-label(for="active") Usuario Dado de Alta

                  .mb-3.row
                    .col-md-12
                      button(type="submit", class="btn btn-primary btn-block") Guardar Cambios
              .modal-footer
                button.btn.btn-secondary(type="button" data-bs-dismiss="modal") Cerrar
    // Agrega el enlace a los archivos JS de Bootstrap 5.0 (Bootstrap 5.0 ya no necesita jQuery)
    //script(src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js", integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4", crossorigin="anonymous")
    script.
      // Función para actualizar el formulario al hacer clic en una fila de la tabla
      const tableRows = document.querySelectorAll("tbody tr");
      const cargosData = !{JSON.stringify(cargosData)}; // Convierte cargosData a objeto JavaScript
      const empleadosData = !{JSON.stringify(empleadosData)}; // Convierte cargosData a objeto JavaScript
      tableRows.forEach((row) => {
        row.addEventListener("click", () => {
          const cells = row.querySelectorAll("td");
          document.getElementById("idEmpleado").value = cells[0].textContent;
          document.getElementById("username").value = cells[1].textContent;
          const IDEmp = cells[0].textContent;
          const empleadosMap = {};
          empleadosData.forEach((empleado) => {
            empleadosMap[empleado.IDEmp] = empleado.Cargo;
          });
          const cargoEncontrado = empleadosMap[IDEmp];
          document.getElementById("role").value = cargoEncontrado || "err"; // Establece el valor en el campo "Rango"
          document.getElementById("active").checked = cells[3].textContent === "Si";
          document.getElementById("direccion").value = cells[4].textContent;
          document.getElementById("celular").value = cells[5].textContent;
          document.getElementById("RFC").value = cells[6].textContent;
          document.getElementById("NSS").value = cells[7].textContent;
          document.getElementById("CURP").value = cells[8].textContent;
          userModalLabel.textContent = `Información del Usuario ${IDEmp}`;
          const userModal = new bootstrap.Modal(document.getElementById("userModal"));
        });
      });
      // Función para actualizar el modal al hacer clic en una fila de la tabla
      const userModal = document.getElementById("userModal");
      const userModalLabel = document.getElementById("userModalLabel");
      const userForm = document.getElementById("userForm");
      const modalInputs = userForm.querySelectorAll("input, select, textarea");
      userModal.addEventListener("hidden.bs.modal", () => {
        modalInputs.forEach((input) => {
          input.value = "";
        });
      });
